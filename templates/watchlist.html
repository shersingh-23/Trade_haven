{% extends 'base.html' %}
{% block title %}Watchlist | TradeHaven{% endblock %}

{% block content %}
<!-- Push content below the fixed navbar -->
<div class="pt-24 flex min-h-screen overflow-hidden">

  <!-- Fixed Sidebar -->
  <aside
    class="w-64 h-[calc(100vh-5rem)] overflow-y-auto shadow-2xl flex flex-col justify-between py-6 px-4 fixed top-20 left-0">
    <div>
      <div class="text-center mb-6">
        <div class="text-[#FFA500] font-bold text-xl uppercase">{{ user.name }}</div>
        <div class="mt-3 mb-2 rounded-lg border border-[#FFA500] py-2 px-4 flex items-center justify-center">
          <h6>WALLET : </h6>
          <span class="text-lg font-semibold text-green-400 ps-2"> ₹ {{ '%.2f' | format(user.balance) }}</span>
        </div>
      </div>
      <nav class="space-y-9 text-sm">
        <a href="/dashboard" class="block hover:text-[#FFA500] mt-[50px] text-center">Dashboard</a>
        <a href="/watchlist" class="block text-[#FFA500] font-bold text-center">WatchList</a>
        <a href="/portfolio" class="block hover:text-[#FFA500] text-center">Portfolio</a>
        <a href="/market" class="block hover:text-[#FFA500] text-center">Market</a>
        <a href="/prediction" class="block hover:text-[#FFA500] text-center">Prediction</a>
        <a href="/transactions" class="block hover:text-[#FFA500] text-center">Transaction</a>
        <a href="/support" class="block hover:text-[#FFA500] text-center">Support</a>
        <a href="/settings" class="block hover:text-[#FFA500] text-center">Setting</a>
      </nav>
    </div>
  </aside>

  <!-- Main Content -->
  <main
    class="flex-1 ml-64 mt-[-80px] p-6 space-y-6 h-[calc(100%-6rem)] scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900">
    <div class="shadow-2xl p-6 rounded-lg shadow">
      <h1 class="text-3xl font-bold text-[#FFA500] mb-6">My Watchlist</h1>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left border-collapse">
          <thead class="text-yellow-400 border-b border-gray-700">
            <tr>
              <th class="py-2">#</th>
              <th>Stock</th>
              <th>Live Price</th>
              <th>Quantity</th>
              <th>Buy</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for symbol in watchlist %}
            <tr class="border-t border-gray-800 ">
              <td class="py-3">{{ loop.index }}</td>
              <td class="text-[#FFA500] font-semibold">{{ symbol }}</td>
              <td>₹{{ '%.2f' | format(prices[symbol]) }}</td>
              <td>
                <form action="/buy/{{ symbol }}" method="POST" class="flex items-center gap-2">
                  <input type="hidden" name="price" value="{{ '%.2f' | format(prices[symbol]) }}">
                  <input
                    type="number"
                    name="quantity"
                    min="1"
                    required
                    class="w-20 px-2 py-1 rounded bg-[#2a2a2a] text-white"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                    onkeydown="return event.keyCode !== 69 && event.keyCode !== 189 && event.keyCode !== 190;"
                    onblur="if (this.value === '' || this.value < 1) this.value = 1;"
                  >
              </td>
              <td>
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-sm px-4 py-1 rounded">Buy</button>
                </form>
              </td>
              <td>
                <a href="/remove_watchlist/{{ symbol }}" class="text-red-500 hover:text-red-600 font-semibold">Remove</a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="py-4 text-center text-gray-400">Your watchlist is empty.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>
{% endblock %}
